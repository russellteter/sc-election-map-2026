# Ralph Loop: v2.2 Analytics Dashboard & Map Polish

## Completion Promise

```
<promise>V2.2-ANALYTICS-COMPLETE</promise>
```

Output this ONLY when ALL of the following are TRUE:
1. Phase 16 Analytics Dashboard committed and deployed
2. All 7 analytics tabs functional with map integration
3. MobileBottomNav component implemented
4. URL deep-linking works for all tab states
5. Build passes with no type errors
6. Manual verification confirms features work

---

## Prompt

Enhance the Blue Intelligence platform with v2.2: Analytics Dashboard & Map Polish.

### PRIORITY 1: Commit Phase 16 Analytics Dashboard

The Analytics Dashboard (Phase 16) is built but uncommitted. Files to stage and commit:

**Routes:**
- src/app/[state]/analytics/page.tsx
- src/app/[state]/analytics/layout.tsx

**Components:**
- src/components/Analytics/AnalyticsDashboard.tsx
- src/components/Analytics/AnalyticsMap.tsx
- src/components/Analytics/AnalyticsTabBar.tsx
- src/components/Analytics/CrossStateComparison.tsx
- src/components/Analytics/DemographicOverlay.tsx
- src/components/Analytics/EndorsementNetwork.tsx
- src/components/Analytics/index.ts

**Hooks:**
- src/hooks/useAnalyticsUrl.ts
- src/hooks/useDemographicData.ts
- src/hooks/useEndorsementData.ts

**Lib:**
- src/lib/crossStateAggregator.ts

**Verification:**
- npm run build passes
- Navigate to /sc/analytics - page loads
- All 7 tabs render (Scenario, Historical, Recruitment, Resources, Demographics, Comparison, Endorsements)
- Commit with: `feat(16): add Unified Analytics Dashboard with 7 strategic features`

### PRIORITY 2: MobileBottomNav Component

Create mobile-optimized bottom navigation for analytics:

**File:** src/components/Analytics/MobileBottomNav.tsx

**Requirements:**
- Fixed bottom navigation bar (visible < 768px)
- 7 tab icons with labels
- Active tab indicator
- Glassmorphic styling matching design system
- Touch-friendly (44px minimum tap targets)
- Smooth tab transitions

**Integration:**
- Add to AnalyticsDashboard.tsx
- Hide desktop tab bar on mobile
- Show MobileBottomNav on mobile

### PRIORITY 3: Map-Tab Integration Verification

Ensure each analytics tab correctly updates the map:

| Tab | Map Behavior |
|-----|--------------|
| Scenario | Click district to flip D/R/Tossup |
| Historical | Show margin delta colors |
| Recruitment | Highlight target districts |
| Resources | Show hot/warm/cool heatmap |
| Demographics | Choropleth by selected layer |
| Comparison | Mini-map grid for 5 states |
| Endorsements | Marker overlay with filters |

**Test each tab:**
1. Click tab
2. Verify map updates
3. Click district on map
4. Verify panel updates with district info

### PRIORITY 4: URL Deep-Linking

Verify URL state sync works for all parameters:

**URL Schema:**
```
/sc/analytics?tab=scenario&chamber=house&scenario=45:D,67:R
/sc/analytics?tab=historical&period=2024-2022
/sc/analytics?tab=demographics&layer=education
/sc/analytics?tab=endorsements&type=labor,newspaper
```

**Test:**
1. Set tab state, copy URL
2. Open URL in new tab
3. Verify state is restored exactly
4. Test with district selection: `?tab=scenario&district=23`

### PRIORITY 5: Polish & Performance

**Dynamic Imports:**
- Ensure all 7 feature panels use React.lazy()
- Verify no bundle bloat (check build output)

**Loading States:**
- Add skeleton loaders for async data
- Show loading spinner during tab transitions

**Error Boundaries:**
- Wrap each tab panel in error boundary
- Graceful fallback for missing data

### VERIFICATION CHECKLIST

Before outputting completion promise, verify:

- [ ] `npm run build` passes
- [ ] `npm run lint` has no new errors
- [ ] /sc/analytics loads without errors
- [ ] All 7 tabs functional
- [ ] Map updates per tab selection
- [ ] URL deep-linking works
- [ ] Mobile nav works (test at 375px viewport)
- [ ] District selection syncs map â†” panel
- [ ] All changes committed to git
- [ ] Pushed to deploy

---

## Context Files

```
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/districtColors.ts
@src/hooks/useMapState.ts
@src/components/Scenario/ScenarioSimulator.tsx
@src/components/Historical/HistoricalComparison.tsx
@src/components/Recruitment/RecruitmentRadar.tsx
@src/components/ResourceHeatmap/ResourceHeatmap.tsx
```

## Existing Phase 15 Components to Wire

These components exist and need to be wired into the Analytics Dashboard:

1. **ScenarioSimulator** - `src/components/Scenario/ScenarioSimulator.tsx`
2. **HistoricalComparison** - `src/components/Historical/HistoricalComparison.tsx`
3. **RecruitmentRadar** - `src/components/Recruitment/RecruitmentRadar.tsx`
4. **ResourceHeatmap** - `src/components/ResourceHeatmap/ResourceHeatmap.tsx`

## Output Format

After each priority, report:
```
Priority X: [COMPLETE/IN PROGRESS/BLOCKED]
- What was done
- Files modified
- Any issues encountered
```

When all priorities are done:
```
<promise>V2.2-ANALYTICS-COMPLETE</promise>
```
