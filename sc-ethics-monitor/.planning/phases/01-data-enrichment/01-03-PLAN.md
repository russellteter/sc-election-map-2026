---
phase: 01-data-enrichment
plan: 03
type: execute
depends_on: ["01-01", "01-02"]
sheets_modified:
  - Districts tab (columns P-R)
domain: python-excel
---

<objective>
Add urban/rural classification and population-based helper columns to the Districts Excel file.

Purpose: Urban, suburban, and rural districts require different campaign strategies. Understanding district demographics helps allocate resources appropriately.

Output: Final enriched Districts Excel file with urban/rural classification, estimated population, and district competitiveness composite score.
</objective>

<execution_context>
**Target File:** `sc-ethics-monitor/data/SC_Ethics_Districts_Enriched.xlsx` (from Plans 01-01, 01-02)

**Current Districts tab structure (after Plans 01-01 and 01-02):**
- A-H: Original district columns
- I-K: County/region columns (from 01-01)
- L-O: Incumbent enrichment columns (from 01-02)

**New columns to add (P-R):**
- P: district_type (Urban, Suburban, Rural, Mixed)
- Q: estimated_population (approximate, for context)
- R: composite_score (recruitment priority formula)

**District type definitions:**
- Urban: Primarily within major city limits (Charleston, Columbia, Greenville, etc.)
- Suburban: Surrounding major cities, high growth areas
- Rural: Low population density, agricultural areas
- Mixed: Contains significant urban and rural areas

**SC Major Urban Areas:**
- Charleston metro (Charleston, Berkeley, Dorchester counties)
- Columbia metro (Richland, Lexington counties)
- Greenville-Spartanburg metro (Greenville, Spartanburg counties)
- Myrtle Beach metro (Horry, Georgetown counties)

**Population reference:**
- SC House districts: ~40,000 people each (based on 2020 census)
- SC Senate districts: ~105,000 people each

**Composite score formula components:**
- term_status weight (Open = 3, First-term = 2, Veteran = 1, Long-serving = 0)
- margin weight (competitive <5% = 3, somewhat <10% = 2, safe >10% = 1, unopposed = 0)
- party weight (R incumbent = 2, Open = 2, D incumbent = 0)
</execution_context>

<tasks>

<task type="auto">
  <name>Task 1: Create geographic classification data module</name>
  <action>
Create a Python module with district type classifications and population estimates.

**File location:** `sc-ethics-monitor/scripts/geographic_data.py`

**Module contents:**
```python
# District type classification based on county and location
# Urban: City-center districts in major metros
# Suburban: Surrounding metro areas
# Rural: Agricultural, low-density areas
# Mixed: Spanning urban and rural areas

# County-level classification hints
COUNTY_TYPES = {
    # Metro cores - typically Urban
    "Charleston": "Urban",
    "Richland": "Urban",
    "Greenville": "Urban",

    # Suburban counties
    "Lexington": "Suburban",
    "Berkeley": "Suburban",
    "Dorchester": "Suburban",
    "York": "Suburban",
    "Spartanburg": "Suburban",

    # Rural counties
    "Abbeville": "Rural",
    "Allendale": "Rural",
    # ... etc
}

# District-specific overrides where county-level is insufficient
HOUSE_DISTRICT_TYPES = {
    # Urban districts (downtown/city-center)
    1: "Urban",   # Greenville downtown
    2: "Urban",   # Greenville
    # Suburban districts
    15: "Suburban",
    # Rural districts
    50: "Rural",
    # Mixed districts
    42: "Mixed",  # Spans urban and rural
    # ... all 124 districts
}

SENATE_DISTRICT_TYPES = {
    # Senate districts are larger, more often Mixed
    1: "Mixed",   # Oconee/Pickens - mostly rural
    # ... all 46 districts
}

# Population estimates (based on 2020 census apportionment)
HOUSE_POPULATION = 40000  # ~40k per House district
SENATE_POPULATION = 105000  # ~105k per Senate district

def get_district_type(chamber: str, district_num: int, primary_county: str) -> str:
    """Get district type, using district-specific data or falling back to county."""
    if chamber == "House":
        return HOUSE_DISTRICT_TYPES.get(district_num, COUNTY_TYPES.get(primary_county, "Rural"))
    else:
        return SENATE_DISTRICT_TYPES.get(district_num, "Mixed")

def get_estimated_population(chamber: str) -> int:
    """Get estimated population for district type."""
    return HOUSE_POPULATION if chamber == "House" else SENATE_POPULATION
```
  </action>
  <verify>
- All 124 House districts have type classification
- All 46 Senate districts have type classification
- County fallback logic works correctly
- Population estimates are reasonable
  </verify>
  <done>Geographic classification data module created</done>
</task>

<task type="auto">
  <name>Task 2: Create composite score calculation function</name>
  <action>
Add composite score calculation to the enrichment scripts.

**Add to:** `sc-ethics-monitor/scripts/incumbent_enrichment.py` or create new file

**Function:**
```python
def calculate_composite_score(
    term_status: str,
    margin: float | str,
    incumbent_party: str,
    incumbent_name: str
) -> int:
    """
    Calculate recruitment priority composite score (0-10).

    Higher score = higher priority for recruitment.

    Components:
    - term_status: Open=3, First-term=2, Veteran=1, Long-serving=0
    - margin: <5%=3, <10%=2, >10%=1, Unopposed=0
    - party: R incumbent=2, Open seat=2, D incumbent=0
    """
    score = 0

    # Term status component (0-3)
    if term_status == "Open":
        score += 3
    elif term_status == "First-term":
        score += 2
    elif term_status == "Veteran":
        score += 1
    # Long-serving = 0

    # Margin component (0-3)
    if margin == "Unopposed" or margin is None:
        score += 0
    elif isinstance(margin, (int, float)):
        if margin < 5:
            score += 3
        elif margin < 10:
            score += 2
        else:
            score += 1

    # Party component (0-2)
    if not incumbent_name or incumbent_name == "":
        score += 2  # Open seat
    elif incumbent_party == "R":
        score += 2  # R incumbent (target)
    # D incumbent = 0

    return score

# Score interpretation:
# 8-10: High priority (Open seat or competitive R)
# 5-7: Medium priority (First-term or somewhat competitive)
# 2-4: Low priority (Safe incumbent)
# 0-1: Very low priority (Safe D incumbent)
```
  </action>
  <verify>
- Open R seats score 8+ (high priority)
- Competitive R incumbents score 5-7 (medium)
- Safe D incumbents score 0-2 (low)
- Score ranges are sensible
  </verify>
  <done>Composite score calculation function created</done>
</task>

<task type="auto">
  <name>Task 3: Update Excel generation for final columns P-R</name>
  <action>
Update `generate_enriched_excel.py` to add geographic columns and composite score.

**Updates needed:**
1. Import geographic_data module
2. Add columns P-R:
   - P: district_type (Urban/Suburban/Rural/Mixed)
   - Q: estimated_population (40000 for House, 105000 for Senate)
   - R: composite_score (0-10 calculated value)
3. Apply conditional formatting for composite_score:
   - 8-10: Red background (high priority)
   - 5-7: Yellow background (medium priority)
   - 2-4: Light green (low priority)
   - 0-1: Green (very low priority)
4. Add data validation dropdown for district_type column
5. Finalize all formatting:
   - Freeze header row
   - Auto-fit column widths
   - Apply consistent borders
  </action>
  <verify>
- Columns P-R added with correct headers
- district_type populated for all 170 districts
- composite_score calculated for all districts
- Conditional formatting shows priority levels
  </verify>
  <done>Excel generation script finalized with all columns A-R</done>
</task>

<task type="auto">
  <name>Task 4: Generate final enriched Excel file</name>
  <action>
1. Run the complete generation script
2. Verify all 170 districts have complete data:
   - Columns A-H: Base district data
   - Columns I-K: County/region data
   - Columns L-O: Incumbent/election data
   - Columns P-R: Geographic/priority data
3. Create summary statistics:
   - Count by district_type
   - Count by region
   - Count by composite_score range
   - Top 20 highest priority districts (score 7+)
4. Save final file to `sc-ethics-monitor/data/SC_Ethics_Districts_Enriched.xlsx`
  </action>
  <verify>
- All 170 rows have complete data (no blank cells)
- Composite scores range from 0-10
- Conditional formatting visible
- File size reasonable (<500KB)
  </verify>
  <done>Final enriched Excel file generated</done>
</task>

<task type="auto">
  <name>Task 5: Create Phase 1 completion summary</name>
  <action>
Generate comprehensive summary of Phase 1 Data Enrichment.

**Create file:** `.planning/phases/01-data-enrichment/01-03-SUMMARY.md`

**Contents:**
- Executive summary of data enrichment
- District type distribution (Urban/Suburban/Rural/Mixed counts)
- Top 10-20 highest composite score districts
- Breakdown by region and district type
- Total data enrichment accomplishments:
  - Columns added: I-R (10 new columns)
  - Data points per district: 10 enrichment fields
  - Total enrichment: 1,700 data points (170 districts x 10 fields)
- Excel file location and import instructions
- Recommendations for Phase 2 (Usability Improvements)
  </action>
  <verify>
- Summary file created with all statistics
- Top priority districts identified
- Import instructions clear
  </verify>
  <done>Phase 1 completion summary created</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] geographic_data.py exists with all classifications
- [ ] Composite score function calculates correctly
- [ ] Excel file has all columns A-R populated
- [ ] All 170 districts have district_type
- [ ] All 170 districts have population estimates
- [ ] composite_score calculated for all districts
- [ ] Conditional formatting applied to score column
- [ ] 01-03-SUMMARY.md created with statistics
</verification>

<success_criteria>
- Districts Excel fully enriched with all planned columns (A-R)
- Urban/rural classification enables demographic targeting
- Composite score provides quick recruitment prioritization
- Phase 1 Data Enrichment complete
- Excel file ready for user to import into Google Sheets
- Ready for Phase 2 Usability Improvements (which will be applied in Google Sheets post-import)
</success_criteria>

<output>
**Final Excel File:** `sc-ethics-monitor/data/SC_Ethics_Districts_Enriched.xlsx`

**Import Instructions for User:**
1. Open Google Sheets at the Source of Truth URL
2. Go to File > Import
3. Select the Excel file
4. Choose "Replace spreadsheet" or "Insert new sheet(s)"
5. Verify all 170 districts and 18 columns imported correctly

**Phase 1 Complete - Proceed to Phase 2 for Google Sheets usability improvements**
</output>
