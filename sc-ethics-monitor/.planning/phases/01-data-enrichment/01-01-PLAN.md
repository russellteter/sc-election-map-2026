---
phase: 01-data-enrichment
plan: 01
type: execute
depends_on: []
sheets_modified:
  - Districts tab (columns I-K)
domain: python-excel
---

<objective>
Add county mapping to the Districts tab via Excel generation, enabling county-level analysis and regional grouping.

Purpose: SC legislative districts often span multiple counties, but knowing the primary county for each district enables county-level campaign coordination and reporting.

Output: Excel file with Districts data enriched with county columns for all 170 districts.
</objective>

<execution_context>
**Target Output:** `sc-ethics-monitor/data/SC_Ethics_Districts_Enriched.xlsx`

**Current Districts tab structure (columns A-H):**
- A: district_id (e.g., "SC-House-042")
- B: district_name
- C: chamber (House/Senate)
- D: district_number
- E: incumbent_name
- F: incumbent_party
- G: incumbent_since
- H: next_election

**New columns to add (I-K):**
- I: primary_county (main county for the district)
- J: all_counties (comma-separated list if multi-county)
- K: region (Upstate/Midlands/Lowcountry/Pee Dee)

**SC Counties (46 total):** Abbeville, Aiken, Allendale, Anderson, Bamberg, Barnwell, Beaufort, Berkeley, Calhoun, Charleston, Cherokee, Chester, Chesterfield, Clarendon, Colleton, Darlington, Dillon, Dorchester, Edgefield, Fairfield, Florence, Georgetown, Greenville, Greenwood, Hampton, Horry, Jasper, Kershaw, Lancaster, Laurens, Lee, Lexington, Marion, Marlboro, McCormick, Newberry, Oconee, Orangeburg, Pickens, Richland, Saluda, Spartanburg, Sumter, Union, Williamsburg, York

**SC Regions:**
- Upstate: Greenville, Spartanburg, Anderson, Pickens, Oconee, Cherokee, York, Chester, Lancaster, Union, Laurens, Abbeville, Greenwood, McCormick, Edgefield
- Midlands: Richland, Lexington, Kershaw, Fairfield, Newberry, Saluda, Aiken, Calhoun, Orangeburg
- Lowcountry: Charleston, Berkeley, Dorchester, Beaufort, Jasper, Colleton, Hampton, Allendale, Bamberg, Barnwell
- Pee Dee: Florence, Horry, Georgetown, Marion, Dillon, Marlboro, Darlington, Chesterfield, Lee, Clarendon, Sumter, Williamsburg

**Data sources:**
- SC legislature website for district-to-county mapping
- Existing incumbents.json for base incumbent data
</execution_context>

<tasks>

<task type="auto">
  <name>Task 1: Create district-to-county mapping data</name>
  <action>
Create a Python script that defines the complete SC district-to-county mapping.

The script should include:
1. A dictionary mapping each of 124 House districts to their counties
2. A dictionary mapping each of 46 Senate districts to their counties
3. A function to determine the primary county (first listed or most populous)
4. A function to determine region based on primary county

**File location:** `sc-ethics-monitor/scripts/district_county_mapping.py`

**Data structure:**
```python
# House districts (1-124) mapped to their counties
HOUSE_DISTRICT_COUNTIES = {
    1: ["Greenville"],
    2: ["Greenville"],
    # ... all 124 districts
}

# Senate districts (1-46) mapped to their counties
SENATE_DISTRICT_COUNTIES = {
    1: ["Oconee", "Pickens"],
    2: ["Anderson"],
    # ... all 46 districts
}

# County to region mapping
COUNTY_REGIONS = {
    "Greenville": "Upstate",
    "Richland": "Midlands",
    # ... all 46 counties
}
```
  </action>
  <verify>
- Script contains all 124 House district mappings
- Script contains all 46 Senate district mappings
- All 46 counties are in the COUNTY_REGIONS mapping
- No duplicate or missing districts
  </verify>
  <done>District-to-county mapping data script created</done>
</task>

<task type="auto">
  <name>Task 2: Create Excel generation script for Phase 1</name>
  <action>
Create a Python script that generates the enriched Districts Excel file.

**File location:** `sc-ethics-monitor/scripts/generate_enriched_excel.py`

**Script requirements:**
1. Import district_county_mapping data
2. Read existing incumbents.json for base data
3. Create Districts worksheet with columns A-K:
   - A-H: Base district data (from incumbents.json or generated)
   - I: primary_county
   - J: all_counties (comma-separated)
   - K: region
4. Apply formatting:
   - Bold headers
   - Appropriate column widths
   - Data validation dropdowns for region column
5. Save to `sc-ethics-monitor/data/SC_Ethics_Districts_Enriched.xlsx`

**Dependencies:** openpyxl
  </action>
  <verify>
- Script runs without errors
- Excel file is created with all 170 rows
- Columns I-K are populated for all districts
- Headers are formatted correctly
  </verify>
  <done>Excel generation script created and functional</done>
</task>

<task type="auto">
  <name>Task 3: Execute script and verify output</name>
  <action>
1. Install openpyxl if needed: `pip install openpyxl`
2. Run the generation script: `python sc-ethics-monitor/scripts/generate_enriched_excel.py`
3. Verify the output Excel file contains:
   - 170 data rows (124 House + 46 Senate)
   - Columns A-K with headers
   - All cells populated (no blanks in I-K)
  </action>
  <verify>
- Excel file exists at expected path
- File opens without errors
- All 170 districts have county data
- Region column matches county assignments
  </verify>
  <done>Excel file generated with county mapping data</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] district_county_mapping.py exists with all mappings
- [ ] generate_enriched_excel.py runs successfully
- [ ] SC_Ethics_Districts_Enriched.xlsx created
- [ ] All 170 districts have primary_county populated
- [ ] All 170 districts have region populated
- [ ] No blank cells in columns I-K
</verification>

<success_criteria>
- Excel file contains complete Districts data with county columns
- All 170 districts mapped to counties and regions
- File ready for subsequent Phase 1 plans to add more columns
- Final file will be imported to Google Sheets after all phases complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-data-enrichment/01-01-SUMMARY.md` with:
- Counties discovered to have most districts
- Distribution of districts by region
- Any data quality notes
- Confirmation of Excel file location
</output>
