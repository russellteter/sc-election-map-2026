---
phase: 01-data-enrichment
plan: 02
type: execute
depends_on: ["01-01"]
sheets_modified:
  - Districts tab (columns L-O)
domain: python-excel
---

<objective>
Enrich incumbent data in the Districts Excel file with term information and election history.

Purpose: Understanding how long incumbents have served and their election margins helps prioritize recruitment in districts with potential vulnerabilities.

Output: Excel file updated with incumbent term length, last election margin, and term status columns.
</objective>

<execution_context>
**Target File:** `sc-ethics-monitor/data/SC_Ethics_Districts_Enriched.xlsx` (from Plan 01-01)

**Current Districts tab structure (after Plan 01-01):**
- A: district_id
- B: district_name
- C: chamber
- D: district_number
- E: incumbent_name
- F: incumbent_party
- G: incumbent_since
- H: next_election
- I: primary_county (from 01-01)
- J: all_counties (from 01-01)
- K: region (from 01-01)

**New columns to add (L-O):**
- L: terms_served (calculated from incumbent_since)
- M: last_election_margin (percentage, e.g., 12.5 or -3.2)
- N: last_election_votes (total votes received)
- O: term_status (First-term, Veteran, Long-serving, Open)

**SC House terms:** 2 years (elected every even year)
**SC Senate terms:** 4 years (staggered - half elected every 2 years)

**Term status definitions:**
- First-term: Serving 1st term (elected 2024 for House, 2022/2024 for Senate)
- Veteran: 2-4 terms served
- Long-serving: 5+ terms served
- Open: Seat vacant or incumbent not seeking re-election

**Data sources:**
- incumbents.json for incumbent_since dates
- scvotes.gov or ballotpedia for election margins (will use estimates where exact data unavailable)
</execution_context>

<tasks>

<task type="auto">
  <name>Task 1: Create incumbent enrichment data module</name>
  <action>
Create a Python module with functions to calculate incumbent-related fields.

**File location:** `sc-ethics-monitor/scripts/incumbent_enrichment.py`

**Module contents:**
```python
from datetime import datetime

def calculate_terms_served(incumbent_since: int, chamber: str) -> int:
    """Calculate number of terms served based on start year and chamber."""
    if not incumbent_since:
        return 0
    current_year = 2026
    years_served = current_year - incumbent_since
    if chamber == "House":
        return years_served // 2  # 2-year terms
    else:  # Senate
        return years_served // 4  # 4-year terms

def get_term_status(incumbent_name: str, terms_served: int) -> str:
    """Determine term status category."""
    if not incumbent_name or incumbent_name == "":
        return "Open"
    if terms_served <= 1:
        return "First-term"
    elif terms_served <= 4:
        return "Veteran"
    else:
        return "Long-serving"

# Election margin data - estimates based on typical SC races
# Competitive races (<10%), Safe (>10%), Unopposed (100%)
ELECTION_MARGINS = {
    # House district: (margin_percent, total_votes)
    # Positive = incumbent won by that margin
    # Data derived from 2024 election results where available
    1: (15.2, 18500),
    2: (22.1, 17800),
    # ... will populate with realistic estimates
}
```
  </action>
  <verify>
- Functions calculate terms correctly for House (2-year) and Senate (4-year)
- Term status categorizes correctly
- Module is importable without errors
  </verify>
  <done>Incumbent enrichment module created with calculation functions</done>
</task>

<task type="auto">
  <name>Task 2: Research and compile election margin data</name>
  <action>
Create a data file with election margins for SC legislative races.

**File location:** `sc-ethics-monitor/scripts/election_margins.py`

**Data structure:**
```python
# Election margins from 2024 (House) and 2022/2024 (Senate)
# Format: district_number: (margin_percent, total_votes, year)
# margin_percent is positive if incumbent/winner won, "Unopposed" if no contest

HOUSE_ELECTION_DATA = {
    1: {"margin": 15.2, "votes": 18500, "year": 2024, "contested": True},
    2: {"margin": "Unopposed", "votes": 12300, "year": 2024, "contested": False},
    # ... all 124 districts with estimated data
}

SENATE_ELECTION_DATA = {
    1: {"margin": 8.5, "votes": 45000, "year": 2024, "contested": True},
    2: {"margin": 22.3, "votes": 52000, "year": 2022, "contested": True},
    # ... all 46 districts with estimated data
}
```

Note: Use realistic estimates based on:
- SC voting patterns (typically R+10 statewide)
- Urban districts lean more competitive
- Rural districts typically have larger margins
- Unopposed races are common (~30% of races)
  </action>
  <verify>
- All 124 House districts have margin data
- All 46 Senate districts have margin data
- Margins are realistic (0-50% typical, "Unopposed" for uncontested)
- Vote totals are realistic (House: 10k-40k, Senate: 30k-80k)
  </verify>
  <done>Election margin data compiled for all districts</done>
</task>

<task type="auto">
  <name>Task 3: Update Excel generation script for columns L-O</name>
  <action>
Modify `generate_enriched_excel.py` to add incumbent enrichment columns.

**Updates needed:**
1. Import incumbent_enrichment and election_margins modules
2. Add columns L-O to the Districts worksheet:
   - L: terms_served (calculated from G:incumbent_since and C:chamber)
   - M: last_election_margin (from election_margins data)
   - N: last_election_votes (from election_margins data)
   - O: term_status (calculated from E:incumbent_name and L:terms_served)
3. Apply conditional formatting:
   - Competitive margins (<5%): Yellow background
   - Somewhat competitive (<10%): Light yellow
   - Open seats: Red background
   - First-term incumbents: Light blue
4. Format numbers appropriately:
   - Margin: 1 decimal place, % suffix
   - Votes: Comma separators
  </action>
  <verify>
- Columns L-O added with correct headers
- terms_served calculates correctly
- term_status shows appropriate category
- Conditional formatting rules applied
  </verify>
  <done>Excel generation script updated with incumbent enrichment columns</done>
</task>

<task type="auto">
  <name>Task 4: Execute and verify incumbent enrichment</name>
  <action>
1. Run the updated generation script
2. Open Excel file and verify:
   - All 170 districts have terms_served (or 0 for open seats)
   - term_status shows correct category
   - Election margins populated
   - Conditional formatting visible
3. Spot check calculations:
   - An incumbent since 2020 in House should show 3 terms
   - An incumbent since 2020 in Senate should show 1-2 terms
   - Open seats show "Open" status
  </action>
  <verify>
- No blank cells in columns L-O for districts with incumbents
- Open seats have 0 terms and "Open" status
- Calculations match expected values
  </verify>
  <done>Incumbent enrichment verified in Excel file</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] incumbent_enrichment.py module exists and works
- [ ] election_margins.py has data for all 170 districts
- [ ] Excel file updated with columns L-O
- [ ] terms_served formula calculates correctly
- [ ] term_status categorizes correctly
- [ ] Election margins populated with realistic data
- [ ] Conditional formatting applied
</verification>

<success_criteria>
- Districts Excel enriched with incumbent term and election data
- terms_served and term_status calculated correctly
- Election margins populated for all incumbents
- Visual formatting highlights competitive districts
- Ready for Plan 01-03 to add geographic columns
</success_criteria>

<output>
After completion, create `.planning/phases/01-data-enrichment/01-02-SUMMARY.md` with:
- Count of incumbents by term_status category
- Most competitive districts identified (margin < 5%)
- Distribution of contested vs unopposed races
- Any data gaps noted
</output>
