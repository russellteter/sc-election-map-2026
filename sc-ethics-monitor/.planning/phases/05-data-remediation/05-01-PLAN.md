---
phase: 05-data-remediation
plan: 01
type: standard
---

# Plan 05-01: Fix Party Detection Name Matching

<objective>
Fix the party detection system so all 28 candidates have accurate party assignment.

Purpose: Currently 75% (21/28) candidates show UNKNOWN party despite matching data existing in party-data.json. The name matching logic is failing.

Output: All candidates in Google Sheet have detected_party populated correctly (D, R, I, or O).
</objective>

<context>
@.planning/phases/05-data-remediation/DESIGN.md
@scripts/run_party_detection.py
@src/sheets_sync.py
@src/party_detector.py
@src/data/party-data.json
</context>

<tasks>

<task type="auto" id="1">
  <name>Add debug logging to party detection</name>
  <action>
    Modify `run_party_detection.py` to add verbose debug logging:
    - Log each candidate name being looked up
    - Log the normalized form of the name
    - Log all party-data.json keys being compared against
    - Log similarity scores for fuzzy matches
    - Log final match result (found/not found)
  </action>
  <verify>Run script with --debug flag and verify logging output shows comparison details</verify>
  <done>Debug logging clearly shows why matches are failing</done>
</task>

<task type="auto" id="2">
  <name>Analyze name format mismatches</name>
  <action>
    Run party detection with debug logging on sample candidates:
    - "Morgan, Tyler A" (Ethics format)
    - Compare against party-data.json entries

    Identify the specific cause:
    - Case sensitivity issue?
    - Comma handling?
    - Middle initial handling?
    - Suffix handling (Jr., Sr., III)?
  </action>
  <verify>Root cause documented with specific examples</verify>
  <done>Know exactly why "Morgan, Tyler A" doesn't match "Morgan, Tyler A"</done>
</task>

<task type="auto" id="3">
  <name>Add direct lookup before fuzzy matching</name>
  <action>
    In party detection logic, add direct lookup step:
    1. Try exact match on normalized name first
    2. Try "Last, First" format directly in candidates dict
    3. Try alternate name forms from party-data.json
    4. Only then fall back to fuzzy matching

    Update `run_party_detection.py` with this lookup order.
  </action>
  <verify>Direct lookup finds exact matches without needing fuzzy matching</verify>
  <done>Direct lookup step implemented and working</done>
</task>

<task type="auto" id="4">
  <name>Fix name normalization function</name>
  <action>
    Ensure `_normalize_name()` handles all cases:
    - "Morgan, Tyler A" -> normalized form
    - "Tyler A. Morgan" -> same normalized form
    - "Tyler Morgan" -> same normalized form
    - Handle suffixes: Jr., Sr., II, III, IV
    - Handle middle initials: "A", "A.", "Anthony"
    - Handle case: upper, lower, mixed

    Test against all 35 SCHouseMap7.0 candidates.
  </action>
  <verify>python -c "from party_detector import normalize; print(normalize('Morgan, Tyler A'))"</verify>
  <done>Normalization produces consistent results for all name formats</done>
</task>

<task type="auto" id="5">
  <name>Re-run party detection on all candidates</name>
  <action>
    Execute updated party detection script:
    ```bash
    cd /Users/russellteter/Desktop/sc-election-map-2026/sc-ethics-monitor
    python scripts/run_party_detection.py --force
    ```

    Verify each candidate now has a party assigned.
  </action>
  <verify>Check Google Sheet - Candidates tab should show 0 UNKNOWN parties</verify>
  <done>All 28 candidates have detected_party value (D, R, I, or O)</done>
</task>

<task type="auto" id="6">
  <name>Verify against party-data.json</name>
  <action>
    Cross-reference results:
    1. Load party-data.json candidates
    2. For each candidate in Google Sheet:
       - Verify detected_party matches party-data.json
       - Flag any mismatches
    3. Report accuracy percentage
  </action>
  <verify>100% accuracy against known party affiliations in party-data.json</verify>
  <done>Party detection matches party-data.json for all known candidates</done>
</task>

</tasks>

<verification>
- [ ] Debug logging shows comparison details for each candidate
- [ ] Root cause of matching failure documented
- [ ] Direct lookup finds exact matches
- [ ] Normalization handles all name format variations
- [ ] All 28 candidates have detected_party assigned
- [ ] Zero UNKNOWN party values in Candidates tab
- [ ] Results verified against party-data.json
</verification>

<success_criteria>
- 100% of candidates have detected_party value
- Zero UNKNOWN or empty party fields
- Party assignments match party-data.json where data exists
- Script runs without errors
</success_criteria>

<output>
Create 05-01-SUMMARY.md documenting:
- Root cause of matching failures
- Fixes implemented
- Before/after party detection counts
- Any candidates that remain unmatched (need research)
</output>
