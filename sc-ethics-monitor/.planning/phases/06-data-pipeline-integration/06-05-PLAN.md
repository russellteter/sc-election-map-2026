---
phase: 06-data-pipeline-integration
plan: 05
type: execute
depends_on: ["06-04"]
files_modified: [.github/workflows/ethics-monitor.yml]
---

<objective>
Set up GitHub Action for daily automated monitor runs at 6am ET.

Purpose: Currently requires manual script execution. A scheduled GitHub Action ensures data stays fresh automatically, with candidates.json updated daily and committed to the repository.

Output: `.github/workflows/ethics-monitor.yml` runs daily, syncs data, exports, and commits changes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@sc-ethics-monitor/.planning/PROJECT.md
@sc-ethics-monitor/.planning/ROADMAP.md
@sc-ethics-monitor/.planning/phases/06-data-pipeline-integration/06-04-SUMMARY.md
@.github/workflows/update-data.yml

**Existing Workflow:**
There's already `.github/workflows/update-data.yml` for data refresh. Use it as reference for structure and secrets.

**Required Secrets:**
- GOOGLE_SHEETS_CREDENTIALS: Service account JSON (base64 encoded)
- FIRECRAWL_API_KEY: For candidate discovery (optional)

**Schedule:**
- 6am ET = 11:00 UTC (during EST) or 10:00 UTC (during EDT)
- Use `cron: '0 11 * * *'` for 6am EST (most of year)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ethics-monitor workflow file</name>
  <files>.github/workflows/ethics-monitor.yml</files>
  <action>
Create `.github/workflows/ethics-monitor.yml`:

```yaml
name: SC Ethics Monitor Daily Sync

on:
  schedule:
    # Run at 6am ET (11:00 UTC during EST, 10:00 UTC during EDT)
    # Using 11:00 UTC to cover most of the year
    - cron: '0 11 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  sync-and-export:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          cd sc-ethics-monitor
          pip install -r requirements.txt

      - name: Create credentials file
        run: |
          echo "${{ secrets.GOOGLE_SHEETS_CREDENTIALS }}" | base64 -d > sc-ethics-monitor/google-service-account.json

      - name: Run monitor with export
        env:
          FIRECRAWL_API_KEY: ${{ secrets.FIRECRAWL_API_KEY }}
        run: |
          cd sc-ethics-monitor
          python -m src.monitor --skip-scrape --export-webapp

      - name: Check for changes
        id: changes
        run: |
          git diff --quiet public/data/candidates.json || echo "changed=true" >> $GITHUB_OUTPUT

      - name: Commit and push changes
        if: steps.changes.outputs.changed == 'true'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add public/data/candidates.json
          git commit -m "chore: update candidates.json from Ethics Monitor

          Automated daily sync from SC Ethics Commission data.

          Co-Authored-By: github-actions[bot] <github-actions[bot]@users.noreply.github.com>"
          git push

      - name: Cleanup credentials
        if: always()
        run: rm -f sc-ethics-monitor/google-service-account.json
```
  </action>
  <verify>
Run: `cat .github/workflows/ethics-monitor.yml | head -30`
Should show valid YAML with schedule and job steps
  </verify>
  <done>
Workflow file created with daily schedule and export step
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>GitHub Action workflow for daily monitor sync</what-built>
  <how-to-verify>
    1. Go to GitHub repository: https://github.com/russellteter/sc-election-map-2026
    2. Navigate to Settings > Secrets and variables > Actions
    3. Verify these secrets exist (or need to be added):
       - GOOGLE_SHEETS_CREDENTIALS (base64 encoded service account JSON)
       - FIRECRAWL_API_KEY (optional, for discovery)
    4. Navigate to Actions tab
    5. Find "SC Ethics Monitor Daily Sync" workflow
    6. Click "Run workflow" to manually trigger
    7. Watch run complete successfully
    8. Verify candidates.json commit appears (if data changed)
  </how-to-verify>
  <resume-signal>Type "approved" if workflow runs successfully, or describe any issues</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document automation in README</name>
  <files>sc-ethics-monitor/README.md</files>
  <action>
Update or create section in sc-ethics-monitor/README.md:

```markdown
## Automation

### Daily Sync (GitHub Action)

The SC Ethics Monitor runs automatically every day at 6am ET via GitHub Actions.

**Workflow:** `.github/workflows/ethics-monitor.yml`

**What it does:**
1. Connects to Google Sheets Source of Truth
2. Syncs latest candidate data from Ethics Commission
3. Exports to `public/data/candidates.json`
4. Commits changes if data updated

**Manual Trigger:**
Go to Actions > "SC Ethics Monitor Daily Sync" > "Run workflow"

**Required Secrets:**
- `GOOGLE_SHEETS_CREDENTIALS`: Base64-encoded service account JSON
- `FIRECRAWL_API_KEY`: (Optional) For candidate discovery

### Local Development

Run manually:
\`\`\`bash
cd sc-ethics-monitor
python -m src.monitor --skip-scrape --export-webapp
\`\`\`

Dry run (no changes):
\`\`\`bash
python -m src.monitor --dry-run --skip-scrape --export-webapp
\`\`\`
```
  </action>
  <verify>
Run: `cat sc-ethics-monitor/README.md | grep -A 5 "Automation"`
Should show automation documentation
  </verify>
  <done>
README updated with automation documentation
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `.github/workflows/ethics-monitor.yml` exists with valid YAML
- [ ] Workflow can be manually triggered from Actions tab
- [ ] Workflow runs successfully (credentials permitting)
- [ ] README documents automation process
</verification>

<success_criteria>
- GitHub Action scheduled for daily 6am ET runs
- Manual trigger available via workflow_dispatch
- Workflow syncs data, exports, and commits changes
- Documentation explains automation
- Phase 6 complete: Google Sheets → Web App pipeline established
</success_criteria>

<output>
After completion, create `sc-ethics-monitor/.planning/phases/06-data-pipeline-integration/06-05-SUMMARY.md`

Include:
- Phase 6 complete summary
- Data pipeline now: Ethics Commission → Google Sheets → candidates.json → Web App
- Party detection rate improvement
- Automation status
</output>
