---
phase: 04-candidate-discovery
plan: 05
type: standard
---

# Plan 04-05: Reporting and Verification

<objective>
Implement coverage gap reporting and verify the complete candidate discovery pipeline.

Purpose: Provide visibility into discovery coverage and enable full pipeline testing.

Output: Working reporter, updated email templates, and verified end-to-end pipeline.
</objective>

<context>
@.planning/phases/04-candidate-discovery/DESIGN.md
@src/candidate_discovery/aggregator.py
@src/candidate_discovery/sheets_integration.py
@src/monitor.py
</context>

<tasks>

<task type="auto" id="1">
  <name>Implement CoverageReport dataclass</name>
  <action>
    Create `src/candidate_discovery/reporter.py` with:
    - CoverageReport dataclass:
      - total_districts (default 170)
      - districts_with_candidates
      - districts_without_candidates
      - candidates_by_party (dict)
      - candidates_by_source (dict)
      - conflicts_found
      - coverage_percentage() method
  </action>
  <verify>CoverageReport instantiates and calculates percentage</verify>
  <done>Coverage report structure is defined</done>
</task>

<task type="auto" id="2">
  <name>Implement CoverageReporter class</name>
  <action>
    Add to reporter.py:
    - CoverageReporter class
    - generate_report(aggregation_result) method
    - Calculates coverage metrics from aggregation result
    - Counts by party, by source, conflicts
    - Returns CoverageReport
  </action>
  <verify>Reporter generates accurate metrics from test data</verify>
  <done>Coverage reporter calculates metrics correctly</done>
</task>

<task type="auto" id="3">
  <name>Implement report formatting</name>
  <action>
    Add to CoverageReporter:
    - format_text_report(report) method
    - Creates human-readable text summary
    - Includes coverage percentage, by-party breakdown, by-source breakdown
    - Lists districts without candidates
    - format_email_section(report) for email integration
  </action>
  <verify>Text report is well-formatted and readable</verify>
  <done>Report formatting produces clear output</done>
</task>

<task type="auto" id="4">
  <name>Integrate reporter into monitor</name>
  <action>
    Update src/monitor.py:
    - Import CoverageReporter
    - After discovery, generate coverage report
    - Include report in monitor stats
    - Log coverage summary to console
  </action>
  <verify>Monitor logs coverage stats after discovery</verify>
  <done>Coverage stats appear in monitor output</done>
</task>

<task type="auto" id="5">
  <name>Update email notification template</name>
  <action>
    Update email notification (if exists) or create email_templates.py:
    - Add CANDIDATE_DISCOVERY section to daily email
    - Show: coverage percentage, candidates by party, by source
    - Highlight new candidates discovered this run
    - List conflicts for manual review
  </action>
  <verify>Email template includes discovery section</verify>
  <done>Email notifications include discovery metrics</done>
</task>

<task type="auto" id="6">
  <name>Create end-to-end integration test</name>
  <action>
    Create `tests/test_discovery_pipeline.py` with:
    - Test full pipeline: sources → aggregator → deduplicator → sheets
    - Mock Firecrawl responses
    - Mock Google Sheets API
    - Verify end-to-end data flow
    - Test with sample data representing all sources
  </action>
  <verify>pytest tests/test_discovery_pipeline.py -v</verify>
  <done>End-to-end pipeline test passes</done>
</task>

<task type="auto" id="7">
  <name>Run verification on subset of real districts</name>
  <action>
    Create `scripts/verify_discovery.py` that:
    - Tests BallotpediaSource on 5 sample districts
    - Verifies candidate extraction works
    - Logs results for manual review
    - Reports any parsing failures

    Run the script and verify output.
  </action>
  <verify>Verification script runs and extracts real candidates</verify>
  <done>Real district verification confirms pipeline works</done>
</task>

<task type="auto" id="8">
  <name>Document discovery CLI usage</name>
  <action>
    Create or update README section in sc-ethics-monitor/:
    - Document FORCE_DISCOVERY=1 environment variable
    - Document DISCOVERY_ENABLED configuration
    - Document DISCOVERY_SOURCES configuration
    - Provide example commands for manual discovery runs
  </action>
  <verify>README has clear discovery documentation</verify>
  <done>Discovery usage is documented</done>
</task>

</tasks>

<verification>
- [ ] CoverageReport calculates metrics correctly
- [ ] Text report is human-readable
- [ ] Email includes discovery section
- [ ] End-to-end test covers full pipeline
- [ ] Real district verification extracts candidates
- [ ] Documentation is complete
</verification>

<success_criteria>
- Coverage reporting provides actionable metrics
- Email notifications include discovery stats
- End-to-end pipeline test validates full flow
- Real district test confirms Ballotpedia scraping works
- Documentation enables manual discovery runs
</success_criteria>

<output>
Create 04-05-SUMMARY.md documenting:
- Reporter implementation
- Email template updates
- End-to-end test coverage
- Real district verification results
- Documentation added
</output>
