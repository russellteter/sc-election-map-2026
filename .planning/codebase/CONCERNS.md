# Concerns - SC Election Map 2026

> Generated: 2026-01-12 | GSD Codebase Mapping

## Critical Issues

### 1. SVG Security Risk (XSS)

**Location:** `src/components/Map/DistrictMap.tsx:158`

**Issue:** Uses `dangerouslySetInnerHTML` with SVG content
```typescript
dangerouslySetInnerHTML={{ __html: processedSvgContent }}
```

**Risk:** XSS vulnerability if SVG data is not sanitized
**Impact:** High - Core map rendering path
**Mitigation:** Basic attribute manipulation only
**Recommendation:** Implement DOMPurify or SVG sanitization library

---

### 2. Zero Test Coverage

**Location:** Entire codebase

**Issue:** No automated tests despite critical UI components
- No Jest/Vitest
- No Testing Library
- No Playwright E2E
- Target coverage: >80%, Current: **0%**

**Files Needing Tests:**
- `src/app/page.tsx` - Main page logic
- `src/components/Map/DistrictMap.tsx` - SVG rendering
- `src/components/Dashboard/SidePanel.tsx` - Interactive UI
- `getDistrictColor()` - Color logic
- `calculateStats()` - Stats calculation

---

### 3. Accessibility Violations (WCAG)

**Locations:** Multiple components

| Issue | Location | WCAG |
|-------|----------|------|
| No keyboard navigation | DistrictMap.tsx | 2.1.1 |
| Missing ARIA labels | All SVG paths | 1.3.1 |
| Color-only information | Map + Legend | 1.4.1 |
| Focus not managed | SidePanel.tsx | 2.4.3 |
| No alt text on icons | CandidateCard.tsx | 1.1.1 |

**Target:** Lighthouse Accessibility >95
**Current:** Likely <70 (untested)

---

## High Priority Issues

### 4. Data Pipeline Dependency

**Location:** `.github/workflows/update-data.yml`

**Issue:** Depends on external SC Ethics Monitor repo
- URL: `https://raw.githubusercontent.com/russellteter/sc-ethics-monitor/main/state.json`
- No fallback if source fails
- No integrity verification
- No error notification

**Risk:** Single point of failure for data freshness

---

### 5. Limited Error Handling

**Locations:**
- `src/app/page.tsx:46-56` - fetch with only console.error
- `src/components/Map/DistrictMap.tsx:50-55` - SVG fetch no user feedback

**Issue:**
- Failed loads show only "Failed to load election data"
- No retry mechanism
- No error recovery UI
- Console errors only

---

### 6. Low Party Enrichment Rate

**Location:** `src/data/party-data.json`

**Current Status:**
- House: 2/33 known = **6%**
- Senate: 0/6 known = **0%**
- Target: >70%

**Impact:** Map shows mostly gray/yellow districts

---

## Medium Priority Issues

### 7. Duplicate Type Definitions

**Locations:**
- `src/app/page.tsx` lines 6-27
- `src/components/Map/DistrictMap.tsx` lines 5-24
- `src/components/Dashboard/SidePanel.tsx` lines 3-22

**Issue:** `Candidate`, `District`, `CandidatesData` defined 3+ times
**Recommendation:** Create shared `types.ts` file

---

### 8. Hardcoded Values (Magic Numbers)

**Locations:**
- Color hex values scattered across files
- District counts (124, 46) hardcoded
- Timing values in CSS

**Examples:**
```typescript
// DistrictMap.tsx:178-186
return '#f3f4f6'; // gray-100
return '#3b82f6'; // blue-500
return '#ef4444'; // red-500
```

**Recommendation:** Move to constants or config file

---

### 9. SVG Performance

**Issue:** Large SVG files
- House: 257 KB (target: <200 KB)
- Senate: 181 KB
- No SVGO compression

**Impact:** Slower initial load

---

### 10. SVG Re-parsing on State Change

**Location:** `src/components/Map/DistrictMap.tsx:59-102`

**Issue:** `useMemo` re-parses SVG when candidatesData or selectedDistrict changes
- DOMParser called on every relevant state update
- Heavy computation in render path

---

### 11. Glassmorphic Design Not Implemented

**Location:** `docs/GLASSMORPHIC_MIGRATION_PLAN.md`

**Status:** Plan exists (34KB), implementation: **0%**

| Component | Current | Target |
|-----------|---------|--------|
| Stats bar | Basic grid | Animated KPI cards |
| Side panel | Plain white | Glassmorphic blur |
| Legend | Simple boxes | Status badges |
| Buttons | Generic gray | Purple brand |

---

## Low Priority Issues

### 12. Placeholder Metadata

**Location:** `src/app/layout.tsx`

```typescript
title: "Create Next App"
description: "Generated by create next app"
```

**Fix:** Update with proper SEO metadata

---

### 13. Missing Documentation

| Missing | Location |
|---------|----------|
| JSDoc comments | All components |
| API documentation | candidates.json format |
| Setup instructions | README.md |
| Deployment guide | Not documented |

---

### 14. No Pre-commit Hooks

**Issue:** ESLint not automatically run before commits
**Recommendation:** Add Husky with `npm run lint`

---

### 15. Mixed Path Resolution

**Issue:** Base path detection duplicated
```typescript
// page.tsx
const basePath = window.location.pathname.includes('/sc-election-map-2026') ? ...

// DistrictMap.tsx
const basePath = window.location.pathname.includes('/sc-election-map-2026') ? ...
```

**Recommendation:** Centralize in utility function

---

## Summary by Severity

| Severity | Count | Examples |
|----------|-------|----------|
| **Critical** | 3 | XSS risk, no tests, accessibility |
| **High** | 3 | Data pipeline, error handling, party enrichment |
| **Medium** | 5 | Duplicate types, magic numbers, performance |
| **Low** | 4 | Metadata, docs, pre-commit, paths |

## Recommended Fix Priority

1. **Accessibility** - Add keyboard support, ARIA labels (WCAG compliance)
2. **Testing** - Install Jest/Playwright, create basic E2E tests
3. **Security** - Add SVG sanitization (DOMPurify)
4. **Error Handling** - Add retry logic, better error UI
5. **Data Pipeline** - Document dependencies, add fallbacks
6. **Type Consolidation** - Create shared types.ts
7. **Glassmorphic Design** - Implement migration plan
8. **Performance** - Compress SVGs, optimize re-parsing
9. **Documentation** - JSDoc, setup guide

## Technical Debt Markers

### TODO Comments Found

None in source code.

### Areas Needing Refactoring

1. **DistrictMap.tsx** - Complex SVG processing could be extracted to hooks
2. **page.tsx** - Stats calculation could be memoized separately
3. **Type definitions** - Should be centralized
4. **Color constants** - Should be in config file

### Missing Features

- [ ] Search/filter functionality (Phase 9)
- [ ] Offline support (service worker)
- [ ] Data validation schema (Zod)
- [ ] Error boundaries
- [ ] Loading skeletons
