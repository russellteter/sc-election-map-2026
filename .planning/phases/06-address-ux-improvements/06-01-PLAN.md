---
phase: 06-address-ux-improvements
plan: 01
type: execute
depends_on: []
files_modified: [src/hooks/useAddressLookup.ts, src/components/VoterGuide/AddressAutocomplete.tsx]
---

<objective>
Add localStorage persistence for voter guide addresses so returning users see their last-used address pre-filled.

Purpose: Improve UX by remembering users' addresses across sessions, reducing friction for repeat visits.
Output: Address persisted to localStorage after successful lookup, auto-populated on page load.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-county-contact-extraction/05-01-SUMMARY.md

**Tech stack available:** Next.js 16, React 19, TypeScript strict mode
**Established patterns:** Custom hooks in src/hooks/, localStorage used for debug flags
**Constraining decisions:** Static export only (no server runtime)

**Key files:**
@src/hooks/useAddressLookup.ts - Address lookup logic with URL param handling
@src/components/VoterGuide/AddressAutocomplete.tsx - Address input component
@src/lib/geocoding.ts - Geocoding utilities (already uses localStorage for debug flag)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add localStorage persistence to useAddressLookup hook</name>
  <files>src/hooks/useAddressLookup.ts</files>
  <action>
Add localStorage persistence for the last successfully looked-up address:

1. Create a storage key constant: `const STORAGE_KEY = 'voter-guide-last-address';`

2. Create a helper to safely get from localStorage (handles SSR):
```typescript
function getStoredAddress(): string | null {
  if (typeof window === 'undefined') return null;
  try {
    return localStorage.getItem(STORAGE_KEY);
  } catch {
    return null; // Handle private browsing mode
  }
}
```

3. Create a helper to safely set to localStorage:
```typescript
function setStoredAddress(address: string): void {
  if (typeof window === 'undefined') return;
  try {
    localStorage.setItem(STORAGE_KEY, address);
  } catch {
    // Silently fail for private browsing
  }
}
```

4. In `handleAddressSubmit`, after successful lookup (before or after URL update at line ~193), call:
```typescript
setStoredAddress(displayName);
```

5. In the URL parameter useEffect (lines 285-293), modify the logic to:
   - First check URL param (shareable links take priority)
   - If no URL param, check localStorage for stored address
   - If found, set initialAddress and auto-submit

6. In `handleReset`, clear the stored address:
```typescript
localStorage.removeItem(STORAGE_KEY);
```

**What to avoid and WHY:**
- Don't store coordinates (privacy concern, addresses are sufficient)
- Don't store in sessionStorage (defeats purpose of persistence)
- Don't block on localStorage errors (private browsing should degrade gracefully)
  </action>
  <verify>
1. `npm run build` passes without errors
2. Manual test: Enter address, lookup succeeds, refresh page → address should be pre-filled
3. Manual test: Click reset → address clears, refresh page → no address pre-filled
4. Manual test: Visit with ?address=X URL param → URL param takes priority over localStorage
  </verify>
  <done>
- localStorage helpers exist and are SSR-safe
- Address saved after successful lookup
- Address loaded on page mount (URL param priority > localStorage)
- Reset clears localStorage
- Build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Add visible "Use My Location" text label for mobile UX</name>
  <files>src/components/VoterGuide/AddressAutocomplete.tsx</files>
  <action>
Enhance the geolocation button to be more discoverable on mobile:

1. Below the address input form (after line 389, before the status message), add a "Use My Location" link that's more visible:

```tsx
{/* Use My Location - More prominent on mobile */}
<div className="flex justify-center mt-3 sm:hidden">
  <button
    type="button"
    onClick={onGeolocationRequest}
    disabled={isLoading || isGeolocating}
    className="flex items-center gap-2 text-sm font-medium transition-all disabled:opacity-50"
    style={{ color: 'var(--class-purple)' }}
  >
    {isGeolocating ? (
      <>
        <svg className="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
          <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
          <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" />
        </svg>
        Getting location...
      </>
    ) : (
      <>
        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 2v2m0 16v2M2 12h2m16 0h2" />
        </svg>
        Use my current location
      </>
    )}
  </button>
</div>
```

This adds a text-labeled location button that:
- Only shows on mobile (sm:hidden = hidden on screens >= 640px)
- Uses the same handler and disabled state as the icon button
- Provides clear text label for better discoverability

**What to avoid and WHY:**
- Don't remove the existing icon button inside the input (desktop users expect it there)
- Don't add redundant click handlers (reuse onGeolocationRequest)
- Don't show on desktop (wastes space, icon is sufficient there)
  </action>
  <verify>
1. `npm run build` passes without errors
2. Mobile viewport (< 640px): "Use my current location" link visible below input
3. Desktop viewport (>= 640px): Link hidden, only icon button in input field
4. Click link → geolocation triggers, loading spinner shows
  </verify>
  <done>
- Mobile-only location link added below form
- Link uses existing geolocation handler
- Proper loading state with spinner and text change
- Hidden on desktop (sm:hidden)
- Build passes
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Manual test: localStorage persistence works across page refreshes
- [ ] Manual test: URL parameters still take priority for shared links
- [ ] Manual test: Reset clears localStorage
- [ ] Manual test: Mobile shows "Use my current location" text link
- [ ] Manual test: Desktop shows only icon button (no text link)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- localStorage address persistence working
- Mobile UX improved with visible location link
</success_criteria>

<output>
After completion, create `.planning/phases/06-address-ux-improvements/06-01-SUMMARY.md`:

# Phase 6 Plan 01: Address UX Improvements Summary

**[Substantive one-liner describing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 6 complete. Ready for Phase 7: Error Handling & Validation.
</output>
