---
phase: 02-county-candidate-data
plan: 01
type: execute
depends_on: ["01-01"]
files_modified:
  - scripts/scrape-sc-sheriffs.py
  - scripts/scrape-scac-officials.py
  - scripts/merge-county-officials.py
  - public/data/county-races.json
---

<objective>
Populate county-races.json with REAL incumbent data for all 46 SC counties using authoritative sources.

Purpose: Replace the 10-county partial data with comprehensive, verified real data for all SC county offices (Sheriff, Auditor, Treasurer, Coroner, Clerk of Court, Register of Deeds, Probate Judge).

Output: Complete county-races.json with real incumbent names and party affiliations for all 46 counties, sourced from SC Sheriffs' Association, SCAC Directory, and county government websites.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-data-file-scaffolding/01-01-SUMMARY.md
@.planning/phases/02-county-candidate-data/02-CONTEXT.md

# Vision: Real data over demo data
# - All 46 counties, all 7 offices
# - Cross-reference multiple sources
# - Scrapers where possible, manual fallback
# - Most recent source wins on conflicts

# Data sources:
# - sheriffsc.org/county_map/ - Sheriff names by county
# - SCAC 2025 Directory PDF - All elected officials
# - County government websites - Verification
# - SC Ethics Commission - Early campaign filers

@src/lib/congressionalLookup.ts (SC_COUNTIES list)
@src/types/schema.ts (CountyRace, CountyData interfaces)
@public/data/county-races.json (current 10-county structure)
@scripts/enrich-parties.py (existing script patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build SC Sheriffs scraper</name>
  <files>scripts/scrape-sc-sheriffs.py</files>
  <action>
Create a Python script that:
1. Fetches the sheriffs' association county list from sheriffsc.org/county_map/
2. Iterates through all 46 counties using the URL pattern: /county_map/county/{id}
3. Extracts for each county:
   - County name
   - Sheriff name
   - Office contact info (for verification)
4. Outputs JSON: {county_name: {sheriff: name, source: "sheriffsc.org", scraped_date: ISO}}

Use requests + BeautifulSoup. Include rate limiting (1 request/second) to be respectful.
Handle errors gracefully - log failures but continue.
Store raw output to scripts/data/sheriffs-raw.json for audit trail.

Avoid:
- No hardcoded county IDs - discover them from the main page
- No parallel requests - sequential with delays
  </action>
  <verify>python scripts/scrape-sc-sheriffs.py --dry-run shows all 46 county sheriff names</verify>
  <done>Script successfully scrapes 46 sheriff names with sources</done>
</task>

<task type="auto">
  <name>Task 2: Extract SCAC Directory data</name>
  <files>scripts/scrape-scac-officials.py</files>
  <action>
Create a Python script that extracts county official data from SCAC sources:

Option A (preferred): Scrape individual county pages from sccounties.org
Option B (fallback): Parse SCAC 2025 PDF (sccounties.org/sites/default/files/uploads/publications/directory/2025/2025_directory_web_ready.pdf)

Extract for each county:
- Auditor name
- Treasurer name
- Coroner name
- Clerk of Court name
- Register of Deeds name
- Probate Judge name

Output JSON: {county_name: {auditor: name, treasurer: name, ...}, source: "sccounties.org", scraped_date: ISO}

For PDF parsing, use PyPDF2 or pdfplumber. Structure varies - may need regex patterns.
Store raw output to scripts/data/scac-raw.json.

Avoid:
- Don't assume consistent PDF formatting - be flexible with parsing
- Don't skip counties that fail - log and continue
  </action>
  <verify>python scripts/scrape-scac-officials.py shows officials for majority of counties</verify>
  <done>Script extracts 6 office types for 46 counties (with logged gaps if any)</done>
</task>

<task type="auto">
  <name>Task 3: Merge sources and update county-races.json</name>
  <files>scripts/merge-county-officials.py, public/data/county-races.json</files>
  <action>
Create a merge script that:
1. Loads sheriffs-raw.json and scac-raw.json
2. Cross-references with existing county-races.json (10 counties)
3. Logs any conflicts between sources (different names for same office)
4. Resolves conflicts: most recent scraped_date wins
5. Outputs complete county-races.json with:
   - All 46 counties
   - 7 offices per county
   - Real incumbent names
   - Party affiliation (lookup from existing data or leave null if unknown)
   - Empty candidates array (filing hasn't opened)
   - termYears: 4 for all offices
   - Source tracking in metadata

Schema must match existing CountyRacesData interface:
```json
{
  "lastUpdated": "2026-01-17T...",
  "counties": {
    "Abbeville": {
      "countyName": "Abbeville",
      "fipsCode": "001",
      "races": [
        {"office": "Sheriff", "incumbent": {"name": "Ray Watson", "party": "Republican"}, "candidates": [], "termYears": 4},
        ...
      ]
    }
  }
}
```

Party data: Use existing party-data patterns or research from election results. Mark as null if unknown.

Avoid:
- Don't lose existing verified data in the 10 populated counties
- Don't make up party affiliations - use null if unknown
  </action>
  <verify>cat public/data/county-races.json | jq '.counties | keys | length' returns 46</verify>
  <done>county-races.json has all 46 counties with real incumbent names</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] All 46 SC counties present in county-races.json
- [ ] Each county has 7 races (Sheriff, Auditor, Treasurer, Coroner, Clerk of Court, Register of Deeds, Probate Judge)
- [ ] Incumbent names are REAL (spot check 5 random counties against official sources)
- [ ] JSON is valid (jq parses without errors)
- [ ] npm run build succeeds
- [ ] Voter guide displays county races correctly for any SC address
- [ ] scripts/data/ contains raw scraped data for audit trail
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- county-races.json expanded from 10 to 46 counties with REAL data
- Data sources documented and scrapers reusable for future updates
- No demo/fake data in incumbent fields
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-county-candidate-data/02-01-SUMMARY.md`:

# Phase 2 Plan 01: County Candidate Data Summary

**[One-liner: What shipped]**

## Accomplishments

- [Counties populated]
- [Data sources used]
- [Verification performed]

## Files Created/Modified

- `scripts/scrape-sc-sheriffs.py` - Scraper for sheriffsc.org
- `scripts/scrape-scac-officials.py` - Scraper for SCAC directory
- `scripts/merge-county-officials.py` - Cross-reference and merge
- `scripts/data/sheriffs-raw.json` - Raw sheriff data
- `scripts/data/scac-raw.json` - Raw SCAC data
- `public/data/county-races.json` - Complete 46-county data

## Decisions Made

[Source prioritization, conflict resolution, party data handling]

## Issues Encountered

[Scraping challenges, missing data, manual research needed]

## Data Quality

- Counties with complete data: X/46
- Counties requiring manual research: [list]
- Source conflicts resolved: [count]

## Next Step

Ready for Phase 3: DemoBadge Integration (though DemoBadge may not be needed for county data if all real!)
</output>
