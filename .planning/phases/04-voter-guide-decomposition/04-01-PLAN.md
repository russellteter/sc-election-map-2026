---
phase: 04-voter-guide-decomposition
plan: 01
type: execute
depends_on: []
files_modified:
  - src/hooks/useVoterGuideData.ts
  - src/hooks/useAddressLookup.ts
  - src/app/voter-guide/page.tsx
---

<objective>
Extract custom hooks from voter-guide/page.tsx to separate data loading and address lookup concerns.

Purpose: Reduce page.tsx complexity by moving reusable logic into dedicated hooks, improving testability and maintainability.
Output: Two new custom hooks (useVoterGuideData, useAddressLookup) with page.tsx refactored to use them.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

@src/app/voter-guide/page.tsx
@src/types/schema.ts

**Prior phase context:**
@.planning/phases/03-demobadge-integration/03-01-SUMMARY.md

**Tech stack available:** Next.js 16, React 19, TypeScript strict mode
**Established patterns:**
- Custom hooks in `src/hooks/` directory
- camelCase for hook names (useVoterGuideData, useAddressLookup)
- Type definitions in `src/types/schema.ts`

**Constraining decisions:**
- Phase 3: DemoBadge inline with titles using flexbox pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useVoterGuideData hook</name>
  <files>src/hooks/useVoterGuideData.ts, src/app/voter-guide/page.tsx</files>
  <action>
Extract data loading logic from page.tsx into a new custom hook:

1. Create `src/hooks/useVoterGuideData.ts` with:
   - AllRacesData interface (move from page.tsx lines 38-48)
   - useVoterGuideData hook that:
     - Returns { data: AllRacesData, isLoading: boolean }
     - Handles basePath detection for GitHub Pages
     - Loads all 9 JSON files in parallel (candidates, statewide, judicial, congressional, county, schoolBoard, specialDistricts, ballotMeasures, electionDates)
     - Uses cache-busting query param
     - Handles errors gracefully (null for failed fetches)

2. Update page.tsx to:
   - Import useVoterGuideData from '@/hooks/useVoterGuideData'
   - Replace useState for allData/isDataLoading with hook call
   - Remove the data loading useEffect (lines 87-124)
   - Keep AllRacesData type import for component props

Do NOT modify any UI/JSX - only extract the data loading logic.
  </action>
  <verify>npm run build succeeds, npm run lint passes, page.tsx compiles without errors</verify>
  <done>useVoterGuideData.ts exists with proper types and data loading logic, page.tsx uses the hook instead of inline useEffect</done>
</task>

<task type="auto">
  <name>Task 2: Create useAddressLookup hook</name>
  <files>src/hooks/useAddressLookup.ts, src/app/voter-guide/page.tsx</files>
  <action>
Extract address lookup logic from page.tsx into a new custom hook:

1. Create `src/hooks/useAddressLookup.ts` with:
   - LookupStatus type (move from page.tsx line 36)
   - ExtendedDistrictResult interface (move from page.tsx lines 50-53)
   - useAddressLookup hook that:
     - Takes router from useRouter() as optional dependency for URL updates
     - Returns: { status, statusMessage, error, isGeolocating, geocodeResult, districtResult, initialAddress, shareUrl, handleAddressSubmit, handleGeolocationRequest, handleReset, handleCopyShareLink, isLoading, hasResults }
     - Move handleAddressSubmit callback (lines 148-237)
     - Move handleGeolocationRequest callback (lines 239-283)
     - Move handleReset function (lines 285-297)
     - Move handleCopyShareLink function (lines 299-315)
     - Move URL parameter handling useEffect (lines 127-135)
     - Move share URL generation useEffect (lines 138-146)

2. Update page.tsx to:
   - Import useAddressLookup from '@/hooks/useAddressLookup'
   - Replace all lookup-related useState calls with hook destructuring
   - Remove the extracted useEffects and callbacks
   - Keep searchParams handling in page (pass to hook if needed)

Computed values isLoading and hasResults should be returned from hook.
  </action>
  <verify>npm run build succeeds, npm run lint passes, address lookup still works (enter address, get results)</verify>
  <done>useAddressLookup.ts exists with all address/lookup logic, page.tsx uses the hook, address lookup functionality unchanged</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] No TypeScript errors
- [ ] Voter guide page loads at localhost:3000/voter-guide
- [ ] Address lookup works (enter SC address, see results)
- [ ] page.tsx reduced by ~200 lines
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Two new hooks created in src/hooks/
- page.tsx uses both hooks instead of inline logic
- Functionality unchanged from user perspective
</success_criteria>

<output>
After completion, create `.planning/phases/04-voter-guide-decomposition/04-01-SUMMARY.md`:

# Phase 4 Plan 01: Extract Custom Hooks Summary

**[Substantive one-liner about what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/hooks/useVoterGuideData.ts` - New hook for data loading
- `src/hooks/useAddressLookup.ts` - New hook for address/lookup logic
- `src/app/voter-guide/page.tsx` - Refactored to use hooks

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 04-02-PLAN.md (Extract UI Components)
</output>
