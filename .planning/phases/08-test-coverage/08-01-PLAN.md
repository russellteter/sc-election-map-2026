---
phase: 08-test-coverage
plan: 01
type: tdd
depends_on: []
files_modified: [__tests__/lib/addressValidation.test.ts]
---

<objective>
TDD implementation for address validation module - comprehensive tests for all validation functions.

Purpose: Establish test coverage for the core validation logic that prevents unnecessary API calls and provides user feedback.
Output: Complete test suite for validateAddress, getErrorSuggestion, and mapApiErrorToUserFriendly functions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/references/tdd.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-error-handling-validation/07-01-SUMMARY.md
@.planning/codebase/TESTING.md

# Source file to test:
@src/lib/addressValidation.ts

**Tech stack available:** Jest 30.2.0, @testing-library/jest-dom 6.9.1, ts-jest 29.4.6
**Established patterns:** Factory functions for test data, describe blocks for grouping
**Constraining decisions:**
- Phase 7: ValidationResult pattern with isValid, errorType, message, suggestion, isWarning
- Phase 7: PO Box returns warning (isWarning: true) not blocking error
</context>

<feature>
  <name>Address Validation Test Suite</name>
  <files>__tests__/lib/addressValidation.test.ts, src/lib/addressValidation.ts</files>
  <behavior>
    ## validateAddress function tests:

    **Empty/Short inputs:**
    - validateAddress('') → { isValid: false, errorType: 'empty', message: 'Please enter your address', suggestion: 'Enter your street...' }
    - validateAddress('   ') → { isValid: false, errorType: 'empty' } (trimmed empty)
    - validateAddress('123') → { isValid: false, errorType: 'too_short' }
    - validateAddress('test') → { isValid: false, errorType: 'too_short' }

    **ZIP-only inputs:**
    - validateAddress('29201') → { isValid: false, errorType: 'zip_only' }
    - validateAddress('29201-1234') → { isValid: false, errorType: 'zip_only' }

    **City-only inputs:**
    - validateAddress('Columbia') → { isValid: false, errorType: 'city_only' }
    - validateAddress('Columbia, SC') → { isValid: false, errorType: 'city_only' }
    - validateAddress('North Charleston') → { isValid: false, errorType: 'city_only' }

    **Missing street number:**
    - validateAddress('Main Street, Columbia') → { isValid: false, errorType: 'missing_street' }

    **PO Box (warning, not error):**
    - validateAddress('PO Box 123, Columbia, SC') → { isValid: true, isWarning: true, errorType: 'po_box_warning' }
    - validateAddress('P.O. Box 456') → { isValid: true, isWarning: true }
    - validateAddress('Post Office Box 789') → { isValid: true, isWarning: true }

    **Valid addresses:**
    - validateAddress('123 Main Street, Columbia, SC') → { isValid: true }
    - validateAddress('456 Elm Ave') → { isValid: true }
    - validateAddress('789 Oak Blvd, Charleston, SC 29401') → { isValid: true }

    ## getErrorSuggestion function tests:
    - getErrorSuggestion('empty') → 'Enter your street address...'
    - getErrorSuggestion('zip_only') → 'Try: 123 Main Street...'
    - getErrorSuggestion(undefined) → undefined

    ## mapApiErrorToUserFriendly function tests:
    - mapApiErrorToUserFriendly('not found') → { errorType: 'error', message: 'Address not found', suggestion: '...' }
    - mapApiErrorToUserFriendly('network error') → { errorType: 'error', message: 'Unable to connect', suggestion: '...' }
    - mapApiErrorToUserFriendly('not in South Carolina') → { errorType: 'error', message: 'Address not in South Carolina', suggestion: '...' }
    - mapApiErrorToUserFriendly('unknown weird error') → { errorType: 'error', message: 'Address lookup failed', suggestion: '...' } (fallback)
  </behavior>
  <implementation>
    Tests should follow established patterns from __tests__/components/*.test.ts:
    - Use describe blocks to group by function
    - Use nested describe for each validation type
    - One assertion focus per test
    - Descriptive test names (should reject empty input, should allow valid address with street number)
  </implementation>
</feature>

<verification>
npm test __tests__/lib/addressValidation.test.ts
# All tests pass, coverage for addressValidation.ts reported
</verification>

<success_criteria>
- All validateAddress edge cases tested (empty, short, ZIP-only, city-only, missing street, PO Box, valid)
- getErrorSuggestion tested for all error types
- mapApiErrorToUserFriendly tested for all error categories
- Tests are readable and follow project patterns
- No implementation changes needed (tests pass against existing code)
</success_criteria>

<output>
After completion, create `.planning/phases/08-test-coverage/08-01-SUMMARY.md`:

# Phase 8 Plan 01: Address Validation TDD Summary

**[Substantive one-liner]**

## RED Phase
- What tests were written
- Why they initially failed (if implementation was missing) or passed (existing implementation)

## GREEN Phase
- How tests passed (existing implementation covered all cases)

## REFACTOR Phase
- Any cleanup done (if any)

## Files Created/Modified
- `__tests__/lib/addressValidation.test.ts` - Complete test suite

## Commits
- test(08-01): add address validation test suite

## Next Step
Ready for 08-02-PLAN.md
</output>
